name: Auto Create PR

on:
  push:
    branches:
      - 'feature/**'
      - 'bugfix/**'

jobs:
  create-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    
    steps:
      - name: Create Pull Request
        if: steps.check-pr.outputs.result == 'false'
        uses: actions/github-script@v7
        env:
          ISSUE_NUMBER: ${{ steps.extract.outputs.ISSUE_NUMBER }}
        with:
          script: |
            const issueNumber = process.env.ISSUE_NUMBER;
            const branchName = context.ref.replace('refs/heads/', '');
            
            // ê¸°ë³¸ê°’ (ì´ìŠˆ ë²ˆí˜¸ê°€ ì—†ì„ ë•Œ)
            let title = branchName;
            let body = `## ğŸ”— Related Issue
            - (ì—°ê²°ëœ ì´ìŠˆ ì—†ìŒ)
            ## ğŸ“ ë³€ê²½ ì‚¬í•­
            ## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
            - [ ] í…ŒìŠ¤íŠ¸ ì™„ë£Œ`;
            
            if (issueNumber) {
              // ì´ìŠˆ ìƒì„¸ ê°€ì ¸ì˜¤ê¸°
              const { data: issue } = await github.rest.issues.get({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: Number(issueNumber),
              });
              
              const issueTitle = issue.title || '';
              const issueUrl = issue.html_url;
              
              // âœ… PR ì œëª©: [#ì´ìŠˆë²ˆí˜¸]
              title = `[#${issueNumber}]`;
              
              // âœ… ë³¸ë¬¸: ì´ìŠˆ ì •ë³´ + Closes + ë³€ê²½ì‚¬í•­/ì²´í¬ë¦¬ìŠ¤íŠ¸
              body = `## ğŸ”— Related Issue
            - #${issueNumber} - [${issueTitle}](${issueUrl})
            
            Closes #${issueNumber}
            
            ## ğŸ“ ë³€ê²½ ì‚¬í•­
            ## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
            - [ ] í…ŒìŠ¤íŠ¸ ì™„ë£Œ`;
            }
            
            // PR ìƒì„±
            await github.rest.pulls.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title,
              head: branchName,
              base: 'develop',
              body,
            });